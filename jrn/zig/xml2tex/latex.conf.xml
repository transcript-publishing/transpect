<?xml-model href="http://transpect.io/xml2tex/schema/xml2tex.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>
<?xml-model href="http://transpect.io/xml2tex/schema/xml2tex.rng" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<set xmlns="http://transpect.io/xml2tex" 
     xmlns:xml2tex="http://transpect.io/xml2tex" 
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  
  <import href="../../xml2tex/latex.conf.xml"/>

  <xsl:param name="cocotex" as="xs:boolean" select="true()"/>

  
  
  
  <xsl:template name="xml2tex:add-publicationtype-specific-meta">
    <xsl:variable name="open-access" as="xs:boolean" 
                 select="some $c in //dbk:chapter/dbk:info/dbk:biblioset/dbk:legalnotice satisfies matches($c, 'Creative\p{Zs}+Commons', 'i') 
                         or 
                         $license-logo-href[normalize-space()]
                         or 
                         $license-text[normalize-space()][matches(.,'BY-')]"/>
   <xsl:if test="not($license-name[normalize-space()](:already applied in main template then:)) 
                 and 
                 $open-access">
     <xsl:value-of select="concat('&#xa;\tpLicenceName{',
                                  replace((//dbk:chapter[dbk:info/dbk:biblioset/dbk:legalnotice[matches(., 'Creative\p{Zs}+Commons', 'i')]])[1]/
                                            dbk:info/dbk:biblioset/dbk:legalnotice[matches(., 'Creative\p{Zs}+Commons', 'i')][1], 
                                          '^.*(Creative\p{Zs}+Commons.+?\)).*$', '$1'),
                                  '}')"/>
    </xsl:if> 
    <xsl:if test="$open-access">
      <xsl:value-of select="'&#xa;\tpLicenceLogo{logos/oasymbol.pdf}'"/>
    </xsl:if>
   <xsl:sequence select="xml2tex:meta2tex(($journal-name, $title-for-running-head)[1], (), 'tpJournalName')"/>
   <xsl:sequence select="'&#xa;\tpSeries{\includegraphics[width=\hsize]{logos/series/REIHENLOGO_KUL_ZIG.png}}&#xa;'"/>
  </xsl:template>

</set>
