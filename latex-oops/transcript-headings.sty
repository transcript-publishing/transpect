\NeedsTeXFormat{LaTeX2e}[2018/12/01]
\ProvidesPackage{transcript-headings}[2021/08/18 transcript]\relax


\def\mydotfill{%
  \nobreak\leaders\hbox{$\m@th
    \mkern \@dotsep mu\textnormal{\normalsize\hbox{.}}\mkern \@dotsep
    mu$}\hskip 1em plus 1fill% Space of at least 2pt; prevents empty dotfills with page number directly after the toc heading.
  \nobreak}

\newdimen\chaphskip \chaphskip7mm %% default
%% Globale Settings: gelten für alle ÜS-Ebenen
\tpAddToDefault{heading}{%
  \tpSetProperty{numbering}{}%
  \tpSetProperty{margin-left}{}% leer um Default "auto" zu überschreiben
  \tpSetProperty{indent}{auto}%
  \tpSetProperty{toc-margin-right}{6em}%
  \ifcollection
    \tpSetProperty{toc-margin-left}{}%
    \tpSetProperty{toc-indent}{}%
  \else
    \tpSetProperty{toc-margin-left}{\tpIfComp{TocNumber}{auto}{0mm}}%
    \tpSetProperty{toc-indent}{auto}%
  \fi
  \tpSetProperty{toc-number-align}{left}%
  \tpSetProperty{toc-number-sep}{\enskip}%
  \tpSetProperty{toc-page-sep}{\mydotfill}%
  \tpSetProperty{toc-title-format}{\sffamily\normalsize}%
  \tpSetProperty{toc-page-format}{\normalfont\sfwidefamily\normalsize}%
  \tpSetProperty{toc-heading}{%
    \tpUseProperty{toc-title-format}%
    \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\newline}{}%
    \tpIfComp{TocNumber}{\tpUseProperty{toc-hang-number}}{}%
    \tpTocLink{%
      \tpUseComp{TocTitle}%
      \tpIfComp{TocSubtitle}{%
        \hfill\break%
        \tpUseComp{TocSubtitle}%
      }{}%
      \tpUseProperty{toc-page-sep}\tpUseComp{TocPage}}%
  }%
  \tpSetProperty{running-heading}{}%
  \tpSetProperty{running-extra}{}%
}

\gdef\tp@currentHeading{}

\tpDeclareHeading{-1}{part}{%
  %% ToC
  %\tpSetProperty{toc-before-hook-part}{\nobreak}
  \tpSetProperty{toc-after-hook-part}{\nopagebreak}
  \tpSetProperty{toc-margin-top}{2.25em}%
  \tpSetProperty{toc-indent}{}%
  \tpSetProperty{toc-title-format}{\sffamily\sbseries\ifx\ts@layout@type\ts@str@layout@mdw\LARGE\else\huge\fi}%
  
  \tpSetProperty{toc-before-entry}{%
    \addvspace{\tpUseProperty{toc-margin-top}}
    \parindent \z@
    \hyphenpenalty=\@M
    \let\\\@centercr
    \rightskip\z@skip\relax
    \parfillskip\@flushglue
    %\par
    %\edef\measurepage{\the\dimexpr\pagegoal-\pagetotal-\baselineskip\relax}%
    %\typeout{TOC BEFORE ENTRY: \measurepage}
    %\ifdim\measurepage<7\baselineskip\relax\newpage\fi%
  }%
  
  \tpSetProperty{toc-heading}{%
    %\ifdim\dimexpr\pagegoal-\pagetotal<8\baselineskip\relax%
    %  \clearpage%
    %\fi%
    \tpUseProperty{toc-title-format}%
    \tpIfComp{TocNumber}{%
      \ifcsname tp-heading-toc-number--1-maxwd\endcsname
        \@tempdima=\csname tp-heading-toc-number--1-maxwd\endcsname%
      \else
        \@tempdima=\z@%
      \fi%
      \leftskip\@tempdima\hskip-\@tempdima\hbox to \@tempdima{\tpTocLink{\tpUseComp{TocNumber}\tpUseProperty{toc-number-sep}}\hss}%
    }{%
      \leftskip\z@%
    }%    
    \tpTocLink{\tpUseComp{TocTitle}}%
  }%
  
  \tpSetProperty{toc-after-entry}{\nopagebreak\par\nopagebreak\addvspace{\tpUseProperty{toc-margin-bottom}}\nopagebreak}% Thing at the end of the entry, after the page number

  
  \tpSetProperty{margin-left}{}% leer um Default "auto" zu überschreiben
  \tpSetProperty{indent}{}% leer um Default "auto" zu überschreiben
  \tpSetProperty{title-format}{%
    \sffamily\sbseries%
    \ifx\ts@layout@type\ts@str@layout@mdw
      \LARGE%
    \else%
      \HUGE%
    \fi%
    \selectfont%
  }%
  \tpSetProperty{quote-block-format}{%
    \hfill\hbox{%
      \vbox{%
        \rightskip\z@
        \hsize.5\textwidth
        \normalfont
        \normalsize
        \nsfwiderfamily
        \@tempdima=\baselineskip% Ticket 15122.
        \baselineskip=\dimexpr0.92\@tempdima\relax% Ticket 15122.
        \tpUseComp{QuoteText}\par
        %% Zitat-Quelle
        \tpIfComp{QuoteSource}{%
          {\itshape\tpUseComp{QuoteSource}\par}%
        }{}%
      }%
    }%
  }
  
  \tpSetProperty{before-heading}{%
    \cleardoublepage
    \null\vskip\headingsep
    \thispagestyle{empty}%
    %\global\let\@chaptermark\@undefined
    \global\let\has@parts\relax
    \immediate\write\@auxout{\string\global\string\let\string\has@parts\string\relax}%
    \ifcollection \global\let\@authormark\@empty\fi
  }%
  
  \tpSetProperty{heading-block}{%
    \gdef\tp@currentHeading{part}%
    % Kolumnentitel setzen.
    \tpIfComp{RunTitle}{%
      \protected@xdef\tp@partmark{\tp@heading@RunTitle}%
    }{
      \protected@xdef\tp@partmark{\tp@heading@Title}%
    }%    
    \tpUseProperty{title-format}%
    %\vskip.5\baselineskip
    \tpIfComp{Number}{\tpUseComp{Number}\enskip}{}%
    \tpUseComp{Title}\par%
    \tpIfComp{Subtitle}{\@@par\vskip\baselineskip\large\bfseries\tpUseComp{Subtitle}\leavevmode\vskip\baselineskip}{}%
    %% Zitat
    \tpIfComp{QuoteBlock}{%
      \vskip2\baselineskip
      \savenotes
      \tpUseComp{QuoteBlock}
      \spewnotes
      \vskip-2\baselineskip
    }{}%
  }%
  \tpSetProperty{after-heading-block}{\vfill}%
}


\gdef\tp@runningHeadingLeft@backmatter{\relax}
\gdef\tp@runningHeadingRight@backmatter{\relax}

\gdef\tp@chaptermark{UNKNOWN CHAPTERMARK}


\tpDeclareHeading{0}{chapter}{%
  % Ticket 13717.
  \if@frontmatter%
  \else
    \if@mainmatter
    \else
      \tpSetProperty{bookmark-level}{-1}
    \fi
  \fi
  
  %% Format IHV-Eintrag
  \tpSetProperty{toc-margin-top}{1\baselineskip}%
  \tpSetProperty{toc-margin-right}{2em}% Begrenzt die Breite, auf der Titel und Untertitel erscheinen können. 2 em sind dann der Platz, auf dem die Seitenzahl »übersteht«.
  \tpSetProperty{toc-number-sep}{\enskip}%
  \tpSetProperty{toc-title-format}{\sbseries\sfchapwidefamily\normalsize}%
  \tpSetProperty{toc-subtitle-format}{\normalfont\sfchapsubtocfamily\normalsize}%
  \tpSetProperty{toc-author-format}{\normalfont\normalsize\sfchapfamily\itshape}%
  \tpSetProperty{toc-number-format}{\normalfont\normalsize\sfchapwidefamily}%
  \tpSetProperty{toc-indent}{0em}%
  \tpSetProperty{toc-margin-left}{0em}%
  \tpSetProperty{toc-heading}{%
    %\ifdim\dimexpr\pagegoal-\pagetotal\relax<7\baselineskip\relax
    %  \clearpage%
    %\fi
    % VBox verhindert durch Seitenumbruch auseinandergerissene Überschriften im Inhaltsverzeichnis.
    \vtop{\strut%
      \tpUseProperty{toc-title-format}%
      \tpIfComp{TocNumber}{%
        \@tempdima=\csname tp-heading-toc-number-0-maxwd\endcsname%
        \@tempdimb=0\p@\relax
        \expandafter\ifx\csname tp-heading-toc-number-1-maxwd\endcsname\relax%
        \else%
          \@tempdimb=\csname tp-heading-toc-number-1-maxwd\endcsname\relax%
        \fi%
        \ifdim\@tempdima<\@tempdimb\relax%
          \@tempdima=\@tempdimb%
        \fi%
        \leftskip\@tempdima\hskip-\@tempdima\hbox to \@tempdima{\tpTocLink{\tpUseComp{TocNumber}}\hss}%
      }{%
        \leftskip\z@%
      }%
      \strut\tpTocLink{\tpUseComp{TocTitle}}%
      \tpIfComp{TocSubtitle}{\nopagebreak\newline{\tpUseProperty{toc-subtitle-format}\tpTocLink{\tpUseComp{TocSubtitle}}}}{}%
      \tpIfComp{TocAuthorNameList}{\nopagebreak\newline{\normalfont\sfchapfamily\itshape\normalsize\tpTocLink{\tpUseComp{TocAuthorNameList}}}}{}%
      \tpUseProperty{toc-number-format}\tpTocLink{\tpUseProperty{toc-page-sep}\tpUseComp{TocPage}}%
      \strut%
    }
  }%
  
  % Unter Umständen nur für Monographien sinnvoll. In jenem Fall dann entsprechend anpassen.
  \tpSetProperty{toc-after-entry}{%
    \ifcollection
    \else
      \nopagebreak%
    \fi%
  }%
  
  %% Format PDF-Bookmarks
  \tpSetProperty{bookmark}{%
    % \tpIfComp{TocAuthor}{\tpUseComp{TocAuthor}:\space}{}%
    \tpIfComp{BMNumber}{%
      \tpUseComp{BMNumber}\space%
    }{}%
    \tpUseComp{BMTitle}%
  }

  \tpSetProperty{title-format}{\ifx\ts@layout@type\ts@str@layout@mdw\huge\else\Huge\fi\sbseries\sfchapfamily}%
  
  \tpSetProperty{quote-block-format}{%
    \parskip\baselineskip
    \rightskip\z@
    % BEGIN: Modifiziertes \raggedright aus der latex.ltx; Ticket 15122.
    %\let\\\@centercr\@rightskip\@flushglue \rightskip\@rightskip
    %\leftskip0.5\textwidth
    %\parindent\z@
    %%%%%%%%%% Modifiziertes \RaggedRight (\raggedright mit Silbentrennung).
    \leftskip0.5\textwidth
    \@rightskip\RaggedRightRightskip
    \rightskip\@rightskip
    % END.
    \normalfont
    \normalsize
    \nsfwiderfamily
    \@tempdima=\baselineskip% Ticket 15122.
    \baselineskip=\dimexpr0.92\@tempdima\relax% Ticket 15122.
    \tpUseComp{QuoteText}%
    %% Zitat-Quelle
    \tpIfComp{QuoteSource}{%
      {\hfill\break\itshape\tpUseComp{QuoteSource}}\par%
    }{%
      \par%
    }%
  }
  
  \tpSetProperty{before-heading}{\cleardoublepage\if@twocolumn\else\null\nobreak\vskip\dimexpr\headingsep-.45mm\relax\fi}%
  
  \tpSetProperty{heading-block}{%
    \gdef\tp@currentHeading{chapter}
    \ifcollection
      \tpIfComp{RunAuthorNameList}{%
        \protected@xdef\tp@authormark{\tp@heading@RunAuthorNameList}%
      }{%
        \protected@xdef\tp@authormark{\tp@heading@AuthorNameList}%
      }
    \else
      \protected@xdef\tp@authormark{\tp@titlepage@AuthorNameList}%
    \fi      
    \tpIfComp{RunNumber}{%
      \protected@xdef\tp@chapternumber{\tp@heading@RunNumber}%
    }{
      \tpIfComp{Number}{%
        \protected@xdef\tp@chapternumber{\tp@heading@Number}%
      }{%
        \global\let\tp@chapternumber\relax%
      }
    }%
    \tpIfComp{RunTitle}{%
      \protected@xdef\tp@chaptermark{\tp@heading@RunTitle}%
    }{
      \protected@xdef\tp@chaptermark{\tp@heading@Title}%
    }%
    %% Titel
    \ifjournal
    \else
      \thispagestyle{empty}
    \fi
    \leftskip\z@
    \leavevmode
    \bgroup
      \raggedright
      \tpIfComp{Number}{\leftskip-\tpUseProperty{indent}}{}%
      \tpUseProperty{title-format}%
      {\tpIfComp{Number}{\tpUseProperty{hang-number}}{}%
       \tpUseComp{Title}}%
      \tpIfComp{Subtitle}{\par\vskip1.1bp\normalfont\fontsize{13.7bp}{17.2bp}\selectfont\sfchapsubfamily\tpUseComp{Subtitle}}{}%
      \par\nobreak
    \egroup
    %% Linie
    \vskip\dimexpr-1\baselineskip\relax
    \smash{\rlap{\lower3.25mm\vbox{\rule{\hsize}{.4\p@}}}}\par%
    %% Autor
    \tpIfComp{AuthorNameList}{%
      \vskip\baselineskip
      {\large\sfwidefamily\itshape\tpUseComp{AuthorNameList}}%
      \par%\vskip\baselineskip
    }{}%
    %% Zitat
    \par
    \tpIfComp{QuoteBlock}{%
      \vskip1\baselineskip
      \savenotes
      \tpUseComp{QuoteBlock}\par%
      \tpIfComp{AuthorNameList}{%
        \vskip\dimexpr-1.68\baselineskip+2\baselineskip\relax%
      }{%
        \vskip-1.68\baselineskip%
      }%
      \spewnotes
    }{}%
  }%
  
  \tpSetProperty{after-skip}{\tpIfComp{AuthorNameList}{1.68\baselineskip}{3.68\baselineskip}}%
}

% Für Zeitschriften.
\global\newcount\@currAffilCnt \global\@currAffilCnt=1
\global\newbox\@articlefooterbox%

\tpDeclareHeading[chapter]{0}{contribution}{%
  \tpSetProperty{extended}{true}% stellt weitere Makros bereit wie \tpAbstract, \tpKeywords etc.
  %\thispagestyle{articlehead}
  
  % Artikel-DOI für die Zeitschriftenauftaktseite. Aus den Makros der Überschrift übernommen.
  % Muss global und ausgewertet sein, damit das Seitenlayout ps@articlehead darauf zugreifen kann.
  \xdef\@articleDOI{\tpUseComp{DOI}}%
  
  \tpSetProperty{affiliation-format}{}%
  \tpSetProperty{affil-block-format}{\tpUseComp{Affiliation}}
  \tpSetProperty{affil-block-face}{\footnotesize\nsffamily}
  \tpSetProperty{author-contact-format}{%Format of a single author's contact information
    \tpIfComp{Affil}{%
      \tpUseComp{FullName} (\tpUseGroupProp{tpAffil}{\tpUseComp{Affil}}{affil-block-format});\par%
      \tpIfComp{Email}{\tpUseComp{Email};\par}{}%
      \tpIfComp{ORCID}{\tpUseComp{ORCID};\par}{}%
    }{}%
  }
  
  \tpSetProperty{counted-name-sep}{,\space}
  \tpSetProperty{before-heading}{%
    \cleardoublepage%
    \if@twocolumn% Kein vspace vor Überschriften zweispaltiger Kapitel.
    \else%
      \null\nobreak\vskip\dimexpr\headingsep-.45mm\relax%
    \fi
    \thispagestyle{articlehead}
    % Lizenzlogo und -text für die Ausgabe in der Fußzeile je Artikel speichern.
    %\global\setbox\@licenceTextFooter = \hbox{}
    
    \xdef\@headingDOI{\tpUseComp{DOI}}
    \def\@headingCopyright{\tpIfComp{LicenceLogo}{\includegraphics[height=7bp]{\tpUseComp{LicenceLogo}}\space\footnotesize\nsffamily\tpUseComp{LicenceName}\space}{}\tpUseComp{Copyright}}
    \tpIfComp{LicenceLogo}{%
      \xdef\@articleLicenceLogo{\tpUseComp{LicenceLogo}}%
    }{
      \global\let\@articleLicenceLogo\relax%
    }
    
    \global\setbox\@articlefooterbox = \vbox{%
      \parindent\z@%
      \tpUseProperty{affil-block-face}%
      \tpUseComp{AuthorContactBlock}\par
      \@headingCopyright%
    }
    \@tempdima = \the\ht\@articlefooterbox
    % Verkleinere die Seite um die Höhe der Fußzeileninformationen.
    \enlargethispage{-\@tempdima}
    %\tpIfComp{AffilBlock}{{\tpUseProperty{affil-block-face}\tpUseComp{AffilBlock}}\par}{}
  }
  
    %% Abstract
  \tpSetProperty{extended-heading}{%
    \tpIfComp{Abstract}{%
      \par\vskip2\baselineskip
        \rightskip\z@
        {\mdseries\sffamily\tpIfComp{AbstractTitle}{\tpUseComp{AbstractTitle}}{Abstract}}\enskip
        {\itshape\tpUseComp{Abstract}}\par%
      }
      {}%
    \tpIfComp{TitleEn}{%
      \par\vskip\baselineskip
      {\mdseries\sffamily\tpIfComp{TitleEnTitle}{\tpUseComp{TitleEnTitle}}{Title}}\enskip
      {\itshape\tpUseComp{TitleEn}\par}%
    }{}
    \tpIfComp{Keywords}{%
      \par\vskip\baselineskip
      {\mdseries\sffamily\tpIfComp{KeywordsTitle}{\tpUseComp{KeywordsTitle}}{Keywords}}\enskip
      {\itshape\tpUseComp{Keywords}\par}%
    }{}%
    %\tpIfCompOr{Abstract}{TitleEn}{%
    %  \tpIfComp{QuoteBlock}{%
    %    \vskip2\baselineskip
    %    \savenotes
    %    \tpUseComp{QuoteBlock}%
    %    \tpIfComp{AuthorNameList}{%
    %      \vskip\dimexpr-1.68\baselineskip+2\baselineskip\relax%
    %    }{%
    %      \vskip-1.68\baselineskip%
    %    }%
    %    \spewnotes
    %  }{}%
    %}{%
    %  \tpIfComp{Keywords}{%
    %    \tpIfComp{QuoteBlock}{%
    %      \vskip2\baselineskip
    %      \savenotes
    %      \tpUseComp{QuoteBlock}
    %      \tpIfComp{AuthorNameList}{%
    %        \vskip\dimexpr-1.68\baselineskip+2\baselineskip\relax%
    %      }{%
    %        \vskip-1.68\baselineskip%
    %      }
    %      \spewnotes
    %    }{}%
    %  }%
    %}%
    \goodbreak%
  }%
}


\tpDeclareHeading{1}{section}{%
  % Ticket 13717.
  \if@frontmatter%
  \else
    \if@mainmatter
    \else
      \tpSetProperty{bookmark-level}{0}
    \fi
  \fi
  
  \ifcollection
    \tpSetProperty{toc-indent}{0em}%
    \tpSetProperty{toc-margin-left}{0em}%
    \tpSetProperty{toc-before-entry}{\nopagebreak}%
    \tpSetProperty{toc-subtitle-format}{\normalfont\normalsize}%
    \tpSetProperty{toc-heading}{%
      \tpUseProperty{toc-title-format}%
      \tpIfComp{TocNumber}{%
        \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\newline}{}%
        \@tempdima=\csname tp-heading-toc-number-1-maxwd\endcsname\relax%
        \@tempdimb=\csname tp-heading-toc-number-0-maxwd\endcsname\relax%
        \ifdim\@tempdima<\@tempdimb\relax
          \@tempdima=\@tempdimb%
        \fi%
        \leftskip\@tempdima\hskip-\@tempdima\hbox to \@tempdima{\tpTocLink{\tpUseComp{TocNumber}}\hss}%
      }{%\leftskip\z@%
        \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\space}{}%
      }%
      \noindent%
      \advance\leftskip by 2em%
      \setbox\@tempboxa=\hbox{\tpUseComp{TocPage}}%
      \rightskip\wd\@tempboxa%
      \tpTocLink{\tpUseComp{TocTitle}}%
      \tpIfComp{TocSubtitle}{%
        \newline%
        {\tpUseProperty{toc-subtitle-format}\tpTocLink{\tpUseComp{TocSubtitle}}}%
      }{}%
      \tpTocLink{\tpUseProperty{toc-page-sep}\rlap{\hb@xt@\wd\@tempboxa{\tpUseComp{TocPage}}}}%
    }%
  \else
    \tpSetProperty{toc-before-entry}{%
      \addvspace{\tpUseProperty{toc-margin-top}}
      \parindent \z@
      \raggedright
    }%
    \tpSetProperty{toc-heading}{%
      \tpUseProperty{toc-title-format}%
      \tpIfComp{TocNumber}{%
        \@tempdima=\csname tp-heading-toc-number-1-maxwd\endcsname\relax%
        \leftskip\@tempdima\hskip-\@tempdima\hb@xt@\@tempdima{\tpUseComp{TocNumber}\tpUseProperty{toc-number-sep}\hss}%
      }{%\leftskip\z@%
        \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\space}{}%
      }%
      \setbox\@tempboxa=\hbox{\tpUseComp{TocPage}}%
      \advance\rightskip\wd\@tempboxa%
      \tpTocLink{\tpUseComp{TocTitle}}%
      \tpIfComp{TocSubtitle}{%
        \newline%
        {\tpUseProperty{toc-subtitle-format}\tpTocLink{\tpUseComp{TocSubtitle}}}%
      }{}%
      \tpTocLink{\tpUseProperty{toc-page-sep}\rlap{\unhbox\@tempboxa}}%
    }%
  \fi
  \tpSetProperty{before-heading}{\addvspace{24.2bp}}%
  \tpSetProperty{number-sep}{\enskip}%
  \tpSetProperty{title-format}{\sffamily\ifx\ts@layout@type\ts@str@layout@mdw\Large\bfseries\else\LARGE\sbseries\fi}%
  \tpSetProperty{subtitle-format}{\normalfont\sffamily\LARGE}%
  \tpSetProperty{before-quote-skip}{1\baselineskip}%
  \tpSetProperty{quote-block-format}{%
    \hfill\vbox{%
      %\justify% Auskommentiert mit Ticket 15122.
      \hsize.5\textwidth
      \normalsize\nsfwiderfamily\mdseries
      \noindent
      \@tempdima=\baselineskip% Ticket 15122.
      \baselineskip=\dimexpr0.92\@tempdima\relax% Ticket 15122.
      \tpUseComp{QuoteText}\par
      \tpIfComp{QuoteSource}{%
        \tpUseComp{QuoteSource}%
      }{}%
    }%
  }{}
  \tpSetProperty{heading-block}{%
    \savenotes
    \bgroup
      \normalfont
      \interlinepenalty\@M
      \tpUseProperty{title-format}%
      \tpIfComp{Number}{\tpUseProperty{hang-number}}{\leftskip\z@}%
      \tpUseComp{Title}\par\nopagebreak%
      \tpIfComp{Subtitle}{\tpUseComp{subtitle-format}\tpUseComp{Subtitle}\nopagebreak\par}{}%\addvspace{12.8bp}\nopagebreak}{}% Ticket 14677.
      \tpIfComp{AuthorNameList}{\itshape\tpUseComp{AuthorNameList}\par}{}%
    \egroup
    \nopagebreak
    \tpIfComp{QuoteBlock}{%
      \vskip\tpUseProperty{before-quote-skip}%
      %\savenotes
      \tpUseComp{QuoteBlock}
      %\spewnotes
      \par}{}%
    \spewnotes
  }%
  %\tpSetProperty{running-heading}{\tpIfComp{RunNumber}{\tpUseComp{RunNumber}\space}{}\tpUseComp{RunTitle}}%
  \tpSetProperty{bookmark}{%
    \tpIfComp{BMNumber}{%
      \tpUseComp{BMNumber}\enskip%
    }{}%
    \tpUseComp{BMTitle}%
  }
  \tpSetProperty{after-heading-block}{\nopagebreak}
  \tpSetProperty{after-skip}{12.8bp}%
}


\tpDeclareHeading[section]{2}{review}{%
  % Im Wesentlichen nur eine Section, aber mit der Möglichkeit, den Runtitle zu setzen.
  %% Format Kolumnentitel
  % Running heading: ungerade Seiten.
  %\tpSetProperty{running-heading}{%
  %  \tpIfComp{RunNumber}{%
  %    \tpUseComp{RunNumber}\enskip%
  %  }{}
  %  \tpUseComp{RunTitle}%
  %}%
  % Running extra: Zusatzoptionen.
  %\tpSetProperty{running-extra}{%
  %  \tpIfComp{RunAuthorNameList}{%
  %    \protected@xdef\tp@runningHeadingLeft@backmatter{\tpUseComp{RunAuthorNameList}}%
  %  }{}%
  %  \tpIfComp{RunTitle}{%
  %    \protected@xdef\tp@runningHeadingRight@backmatter{\tpUseComp{RunTitle}}%
  %  }{}%
  %  \tpIfComp{RunAuthorNameList}{%
  %    \protected@xdef\@authormark{\tpUseComp{RunAuthorNameList}}%
  %  }{\global\let\@authormark\@empty%
  %    \xdef\@authormark{\tpRunBookTitle}%
  %    \if@frontmatter%
  %    \else
  %      \if@mainmatter
  %      \else
  %        \expandafter\gdef\expandafter\@partmark\expandafter{\tpUseComp{Title}}%
  %      \fi
  %    \fi
  %  }%
  %}
}

\tpDeclareHeading[section]{2}{subsection}{%
  % Ticket 13717.
  \if@frontmatter%
  \else
    \if@mainmatter
    \else
      \tpSetProperty{bookmark-level}{1}
      \tpSetProperty{toc-level}{section}
    \fi
  \fi

  \tpSetProperty{before-heading}{\addvspace{11.5bp}}%
  \tpSetProperty{title-format}{\sffamily\ifx\ts@layout@type\ts@str@layout@mdw\sbseries\else\mdseries\fi\Large}%
  \tpSetProperty{before-quote-skip}{.5\baselineskip}%
  \tpSetProperty{running-heading}{}% da subsection sonst die Kolumnentitel ebenfalls von section erben würde
  \tpSetProperty{toc-number-sep}{\enskip}
  \ifcollection
  \else
    \tpSetProperty{toc-indent}{2em}%
    \tpSetProperty{toc-margin-left}{4em}%
    \tpSetProperty{toc-margin-right}{0\p@}%
  \fi
  \ifcollection
    \tpSetProperty{toc-heading}{%
      \tpUseProperty{toc-title-format}%
      \@tempdima=\csname tp-heading-toc-number-2-maxwd\endcsname\relax%
      \@tempdimb=\csname tp-heading-toc-number-1-maxwd\endcsname\relax%
      \@tempdimc=\csname tp-heading-toc-number-0-maxwd\endcsname\relax%
      \ifdim\@tempdimb<\@tempdimc\relax
        \@tempdimb=\@tempdimc\relax%
      \fi%
      \tpIfComp{TocNumber}{%
        \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\newline}{}%
        \leftskip\dimexpr\@tempdima+\@tempdimb\relax\hskip-\@tempdima\hbox to \@tempdima{\tpTocLink{\tpUseComp{TocNumber}}\hss}%
      }{%\leftskip\z@%
        \leftskip\@tempdimb%
        \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\space}{}%
      }%
      \noindent%
      %\advance\leftskip by 4em%
      \setbox\@tempboxa=\hbox{\tpUseComp{TocPage}}%
      \rightskip\wd\@tempboxa plus 1fil% 1fil sorgt für Linksbündigkeit des IHV-Eintrags.
      \tpTocLink{\tpUseComp{TocTitle}}%
      \tpIfComp{TocSubtitle}{\newline{\tpUseProperty{toc-subtitle-format}\tpTocLink{\tpUseComp{TocSubtitle}}}}{}%
      \tpTocLink{\tpUseProperty{toc-page-sep}\rlap{\hb@xt@\wd\@tempboxa{\hss\tpUseComp{TocPage}}}}%
    }%
  \else
    \tpSetProperty{toc-before-entry}{%
      \addvspace{\tpUseProperty{toc-margin-top}}
      \parindent \z@
      \raggedright
    }%
    \tpSetProperty{toc-heading}{%
      \tpUseProperty{toc-title-format}%
      \tpIfComp{TocNumber}{%
        \@tempdima=\csname tp-heading-toc-number-1-maxwd\endcsname\relax%
        \@tempdimb=\csname tp-heading-toc-number-2-maxwd\endcsname\relax%
        \leftskip\dimexpr\@tempdima+\@tempdimb\relax\hskip-\@tempdimb\hb@xt@\@tempdimb{\tpUseComp{TocNumber}\tpUseProperty{toc-number-sep}\hss}%
      }{%\leftskip\z@%
        \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\space}{}%
      }%
      \setbox\@tempboxa=\hbox{\tpUseComp{TocPage}}%
      \advance\rightskip\wd\@tempboxa%
      \tpTocLink{\tpUseComp{TocTitle}}%
      \tpIfComp{TocSubtitle}{%
        \newline%
        {\tpUseProperty{toc-subtitle-format}\tpTocLink{\tpUseComp{TocSubtitle}}}%
      }{}%
      \tpTocLink{\tpUseProperty{toc-page-sep}\rlap{\unhbox\@tempboxa}}%
    }%
  \fi
}


\tpDeclareHeading[section]{3}{subsubsection}{%
  \tpSetProperty{before-heading}{%
    %\tp@spaceIfAfterChapterHeading{-1\baselineskip}% Ticket 13181, 2022-08-09
    \addvspace{1\baselineskip}%
  }%
  %\tpSetProperty{after-skip}{1sp}% Ticket 12534, 2022-04-25
  \tpSetProperty{title-format}{\sffamily\ifx\ts@layout@type\ts@str@layout@mdw\large\itshape\else\Large\mdseries\fi}%
  \ifcollection\else
    %\tpSetProperty{toc-indent}{8em}%
    \tpSetProperty{toc-margin-left}{6.5em}%
  \fi
  \tpSetProperty{toc-heading}{%
    \tpUseProperty{toc-title-format}%
    \tpIfComp{TocNumber}{%
      \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\newline}{}%
      \@tempdima=\csname tp-heading-toc-number-3-maxwd\endcsname\relax%
      \@tempdimb=\csname tp-heading-toc-number-1-maxwd\endcsname\relax%
      \@tempdimc=\csname tp-heading-toc-number-0-maxwd\endcsname\relax%
      \ifdim\@tempdimb<\@tempdimc\relax
        \@tempdimb=\@tempdimc\relax%
      \fi%
      \@tempdimc=\csname tp-heading-toc-number-2-maxwd\endcsname\relax%
      \leftskip\dimexpr\@tempdima+\@tempdimb+\@tempdimc\relax\hskip-\@tempdima\hbox to \@tempdima{\tpTocLink{\tpUseComp{TocNumber}}\hss}%
    }{%\leftskip\z@%
      \tpIfComp{TocAuthorNameList}{\tpTocLink{\tpUseComp{TocAuthorNameList}:}\space}{}%
    }%
    \tpTocLink{\tpUseComp{TocTitle}}%
    \tpIfComp{TocSubtitle}{\newline{\tpUseProperty{toc-subtitle-format}\tpTocLink{\tpUseComp{TocSubtitle}}}}{}%
    \tpTocLink{\tpUseProperty{toc-page-sep}\tpUseComp{TocPage}}%
  }%
  \tpSetProperty{quote-block-format}{%
    \hfill\vbox{%
      %\justify% Auskommentiert mit Ticket 15122.
      \hsize.5\textwidth
      \normalsize\nsfwiderfamily\mdseries
      \noindent
      \@tempdima=\baselineskip% Ticket 15122.
      \baselineskip=\dimexpr0.92\@tempdima\relax% Ticket 15122.
      \tpUseComp{QuoteText}\par
      \tpIfComp{QuoteSource}{%
        \tpUseComp{QuoteSource}%
      }{}%
      \vskip\baselineskip%
    }%
  }{}
  \tpSetProperty{after-skip}{\z@}%
}

\tpDeclareHeading[section]{4}{paragraph}{%
  \tpSetProperty{before-heading}{\addvspace{12.8bp}}%
  \tpSetProperty{after-skip}{1sp}%
  \tpSetProperty{title-format}{\normalfont\sffamily\normalsize}% 2022-06-02: \sffamily war vorher \sfwidefamily; 12745
}

\tpDeclareHeading{5}{subparagraph}{%
  \tpSetProperty{before-heading}{\addvspace{12.8bp}}%
  \tpSetProperty{after-skip}{-.5em}%
  \tpSetProperty{title-format}{\normalfont\sffamily\normalsize\mdseries}%
}

\endinput
