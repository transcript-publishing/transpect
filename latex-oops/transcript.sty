%%
%% Pusblisher specific style sheet for transcript
%% To be used with le-tex cocotex.cls.
%%
%% Maintainer: p.schulz@le-tex.de
%%
%% lualatex  -  texlive > 2019
%%
\NeedsTeXFormat{LaTeX2e}[2018/12/01]
\ProvidesPackage{transcript}[2021/04/09 transcript]\relax

% Übergangsvariable für TeXLive 2023.
\newif\if@TLtwenty \@TLtwentyfalse
\ifnum\luatexversion>111 \@TLtwentytrue\fi

%% Paketoptionen
%% durchreichen der script-Optionen
\define@key{transcript.sty}{lay}[b]{\gdef\lay{lay=#1}\gdef\layout{#1}}
\DeclareOptionX{nohead}{\global\let\n@head\relax}
\define@key{transcript.sty}{captions}[top]{\gdef\ts@caps{#1}}
\define@key{transcript.sty}{captions_figure}[top]{\gdef\ts@caps@figure{#1}}
\define@key{transcript.sty}{captions_table}[top]{\gdef\ts@caps@table{#1}}
\define@key{transcript.sty}{journal_series}[]{\gdef\ts@journal@series{#1}}
\define@key{transcript.sty}{lay_type}[]{\gdef\ts@layout@type{#1}}

\gdef\ts@str@journal@aua{aua}
\gdef\ts@str@journal@jes{jes}
\gdef\ts@str@journal@zig{zig}
\gdef\ts@str@journal@zwg{zwg}

\gdef\ts@str@layout@mdw{mdw}
\gdef\ts@str@layout@std{std}
\gdef\ts@str@layout@xtx{xtx}

% Pfade sind nach Priorität geordnet und werden von TeX derart durchsucht.
% Dateiendungen können weggelassen werden und werden nach TeX-interner Prioritätenliste (\Gin@extensions) gewählt:
%     .pdf,.png,.jpg,.mps,.jpeg,.jbig2,.jb2,.PDF
\graphicspath{{logos/cc/}{logos/}{images/}{series/}}

%% Alternative Schriften; zuschaltbar im Falle fehlender Zeichen in den Standardschriften.
\newif\if@altFonts \@altFontsfalse
\DeclareOptionX{altFonts}{\@altFontstrue}

\ProcessOptionsX\relax
\ifjournal\collectiontrue\fi

%% Seitenzähler unter der Annahme, dass keine Titelei erzeugt wird.
%% Das Titeleimodul setzt den Seitenzähler bei Aufruf auf 1.
\setcounter{page}{5}

% U. a. für linksbündige Motti auf der rechten Seitenhälfte bei Kapiteln verwendet.
\usepackage{ragged2e}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Logische Operatoren für tpComps. %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\if@argA
\newif\if@argB

\long\def\tpIfCompAnd#1#2#3#4{%
  \@argAfalse
  \@argBfalse
  \expandafter\ifcsname tp@\tp@cur@cont @#1\endcsname
    \expandafter\ifx\csname tp@\tp@cur@cont @#1\endcsname\relax\else
      \@argAtrue
    \fi
  \fi
  \expandafter\ifcsname tp@\tp@cur@cont @#2\endcsname
    \expandafter\ifx\csname tp@\tp@cur@cont @#2\endcsname\relax\else
      \@argBtrue
    \fi
  \fi
  \if@argA
    \if@argB
      #3%
    \else
      #4%
    \fi
  \else
    #4%
  \fi%
}

\long\def\tpIfCompOr#1#2#3#4{%
  \@argAfalse
  \@argBfalse
  \expandafter\ifcsname tp@\tp@cur@cont @#1\endcsname
    \expandafter\ifx\csname tp@\tp@cur@cont @#1\endcsname\relax\else
      \@argAtrue
    \fi
  \fi
  \expandafter\ifcsname tp@\tp@cur@cont @#2\endcsname
    \expandafter\ifx\csname tp@\tp@cur@cont @#2\endcsname\relax\else
      \@argBtrue
    \fi
  \fi
  \if@argA
    {#3\relax}%
  \else
    \if@argB
      {#3\relax}%
    \else
      {#4\relax}%
    \fi
  \fi%
}

%%%%%%%%%%
% Fonts  %
%%%%%%%%%%
\usepackage{transcript-fonts}

\newdimen\tp@majuscleHeight

\def\circledNumber#1{\raisebox{.2pt}{\textcircled{\raisebox{-1.2pt}{\sffamily #1}}}}

\usepackage{newunicodechar}
%\newunicodechar{↩}{\ifmmode\hookleftarrow\else$\hookleftarrow$\fi}% 8617
\newunicodechar{‐}{\penalty\@M-\hskip\z@skip}% 8617, U+2010, ersetzt durch U+002D.
\newunicodechar{‑}{\hbox{-}\penalty\@M\hskip\z@skip}% 8617, U+2011 (non-breaking hyphen).
\newunicodechar{↩}{\hskip\z@skip}
\newunicodechar{。}{\hbox{$_\circ$\enskip\ignorespaces}}
\newunicodechar{、}{,\enskip\ignorespaces}
\newunicodechar{；}{;\enskip\ignorespaces}
\newunicodechar{：}{:\enskip\ignorespaces}
\newunicodechar{，}{,\enskip\ignorespaces}
\newunicodechar{⌈}{$\lceil$}
\newunicodechar{⌉}{$\rceil$}
\newunicodechar{⌊}{$\lfloor$}
\newunicodechar{⌋}{$\rfloor$}
\newunicodechar{①}{\circledNumber{1}}
\newunicodechar{②}{\circledNumber{2}}
\newunicodechar{③}{\circledNumber{3}}
\newunicodechar{④}{\circledNumber{4}}
\newunicodechar{⑤}{\circledNumber{5}}
\newunicodechar{⑥}{\circledNumber{6}}
\newunicodechar{⑦}{\circledNumber{7}}
\newunicodechar{⑧}{\circledNumber{8}}
\newunicodechar{⑨}{\circledNumber{9}}
%\newunicodechar{ǀ}{|}

\newunicodechar{ǀ}{%
  \setbox\@tempboxa = \hbox{K}% Beliebige Versalie.
  \tp@majuscleHeight = \ht\@tempboxa%
  {\fontsize{\the\tp@majuscleHeight}{0bp}\selectfont\raisebox{\the\dimexpr0.24\tp@majuscleHeight\relax}{\unichar{ǀ}}}%
}
\newunicodechar{ǁ}{%
  \setbox\@tempboxa = \hbox{K}% Beliebige Versalie.
  \tp@majuscleHeight = \ht\@tempboxa%
  {\fontsize{\the\tp@majuscleHeight}{0bp}\selectfont\raisebox{\the\dimexpr0.24\tp@majuscleHeight\relax}{\unichar{ǁ}}}%
}
\newunicodechar{ǂ}{%
  \setbox\@tempboxa = \hbox{K}% Beliebige Versalie.
  \tp@majuscleHeight = \ht\@tempboxa%
  {\fontsize{\the\tp@majuscleHeight}{0bp}\selectfont\raisebox{\the\dimexpr0.24\tp@majuscleHeight\relax}{\unichar{ǂ}}}%
}
\newunicodechar{ǃ}{%
  \setbox\@tempboxa = \hbox{K}% Beliebige Versalie.
  \tp@majuscleHeight = \ht\@tempboxa%
  {\fontsize{\the\dimexpr1.4\tp@majuscleHeight\relax}{0bp}\selectfont\raisebox{\the\dimexpr0\tp@majuscleHeight\relax}{\unichar{ǃ}}}%
}

\DeclareRobustCommand\unichar[1]{\textfallback{#1}}

%%%%%%%%%%%%%%
% Font sizes %
%%%%%%%%%%%%%%

\usepackage{transcript-fontsizes}

%%%%%%%%%%%%%%%
% page layout %
%%%%%%%%%%%%%%%
\usepackage[\lay]{transcript-pagelayout}

%%%%%%%%%%%%%%%
% Page Styles %
%%%%%%%%%%%%%%%

\usepackage{transcript-pagestyles}

\gdef\cleardoublepage{%
  \clearpage
  \ifodd\c@page\relax\else
    \hbox{}\thispagestyle{empty}\newpage
    \if@twocolumn\hbox{}\thispagestyle{empty}\newpage\fi
  \fi}

%%%%%%%%%%%%%%%%%
% Überschriften %
%%%%%%%%%%%%%%%%%

\usepackage{transcript-headings}

%%%%%%%
% TOC %
%%%%%%%

\usepackage{transcript-toc}

%%%%%%%%%%%%%
% Footnotes %
%%%%%%%%%%%%%

\usepackage{transcript-notes}

%%%%%%%%%%%%%%%%
% Gleitobjekte %
%%%%%%%%%%%%%%%%

\usepackage{transcript-floats}

%%%%%%%%%%%%%%%%%%%%%%%
% Gestaltungselemente %
%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{transcript-envs}

%%%%%%%%%%%%%%%%%%%%%%%%
% Literaturverzeichnis %
%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{transcript-bib}

\def\source#1{\leavevmode\par#1}

%%%%%%%%%%%
% Titelei %
%%%%%%%%%%%
\usepackage{transcript-title}

\def\flq{‹}
\def\frq{›}

%%%%%%%%%%%%
% Register %
%%%%%%%%%%%%

\usepackage{transcript-index}

\renewcommand\frontmatter{%
  \cleardoublepage
  \@frontmattertrue%
  \@mainmatterfalse%
  \@backmatterfalse%
  \pagenumbering{arabic}%
}

\renewcommand\mainmatter{%
  \cleardoublepage
  \@frontmatterfalse%
  \@mainmattertrue%
  \@backmatterfalse%
}

\newif\if@backmatter \@backmatterfalse
\renewcommand\backmatter{%
  \cleardoublepage
  \@frontmatterfalse%
  \@mainmatterfalse%
  \@backmattertrue%
  \pagestyle{backmatter}%
}

\def\tp@str@heading{heading}
\newunicodechar{…}{\ldots}


\gdef\tp@languageRules@arabic{%
  \rmfamily% Andere Schriften (bspw. \nsfwidefamily) verursachen einen Konvertierungsabbruch.
  \let\par\relax%
  \gdef\ldots{.\kern\fontdimen3\font.\kern\fontdimen3\font.\kern\fontdimen3\font}%
}

\gdef\tp@languageRules@french{%
  \NoAutoSpacing% Keine automatischen Leerzeichen bspw. vor Satzschlusspunkten.
}

\gdef\tp@languageRules@greek{%
  % Hier jeden Fall einzeln berücksichtigen, falls ein universeller Faktor keine Lösung darstellt.
  % BEGIN: Musterblock.
  %\bgroup
  %  \footnotesize
  %  \global\@tempdima=\f@size\p@
  %\egroup
  %\ifdim\f@size\p@=\@tempdima\relax
  %  \fontsize{6.8bp}{\the\baselineskip}\selectfont%
  %\fi
  %\bgroup
  %  \normalsize
  %  \global\@tempdima=\f@size\p@
  %\egroup
  %\ifdim\f@size\p@=\@tempdima\relax
  %  \fontsize{7.8bp}{\the\baselineskip}\selectfont%
  %\fi
  % END.
  \sffamily%
  \ifx\@currenvir\tp@str@heading
    \bfseries%
  \fi
  \fontsize{0.8468\dimexpr\f@size\p@\relax}{\the\baselineskip}\selectfont%
}

\let\@foreignNewLanguageRules\foreignlanguage
\gdef\foreignlanguage#1#2{%
  \protect\@foreignNewLanguageRules{#1}{%
    \ifcsname tp@languageRules@\languagename\endcsname\csname tp@languageRules@\languagename\endcsname\fi
    #2%
  }%
}

\let\@selectNewLanguageRules\selectlanguage
\gdef\selectlanguage#1{%
  \protect\@selectNewLanguageRules{#1}%
  \ifcsname tp@languageRules@\languagename\endcsname
    \csname tp@languageRules@\languagename\endcsname
  \fi
}%

\def\tpNewTocPage{\addtocontents{toc}{\protect\newpage}}

% Makro für verlinkte Bilder.
\let\imgHref\href

\def\@nohyphen#1\@nil#2#3\relax{\imgHref{#1}{{#2}}\hskip0sp\@plus1sp\discretionary{}{}{}\ifx\relax#2\else\@nohyphen#1\@nil#3\relax\fi}
\protected\def\href#1#2{{\let↩\@empty\@nohyphen#1\@nil#2{}\relax\relax}}
\let\fn@href\href
% \bgroup
% \let↩\relax
% \gdef\fn@href#1#2{\@fn@href #1\@nil #2↩↩\@nil}%
% \gdef\href#1#2{\@fn@href #1\@nil #2↩↩\@nil}%
% \gdef\@fn@href #1\@nil #2↩#3↩\@nil{\oldhref{#1}{#2}\hskip\z@skip\if!#3!\else\@fn@href #1\@nil #3↩\@nil\fi}
% \egroup
\usepackage[normalem]{ulem}
\let\ul\uline
\AtBeginDocument{%
  \ifx\tpRunBookTitle\@undefined
    \PackageError{transcript.sty}{No BookTitle given!}{}%
    \def\tpRunBookTitle{--~book title not defined~--}%
  \fi
}


\def\tpNoIndent{%
  \global\@noskipsectrue
  \everypar{%
    \if@noskipsec
      \global\@noskipsecfalse
      {\setbox\z@\lastbox}%
      \clubpenalty\@M
      \unskip
      \@tempskipa \parskip\relax
      \hskip -\@tempskipa
    \else
      \everypar{}%
    \fi%
  }%
}

\def\parbreak{%
  \par
  \vskip\baselineskip
  \tpNoIndent%
}

\endinput
